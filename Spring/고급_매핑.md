# ìƒì† ê´€ê³„ ë§¤í•‘

ë°ì´ë²„ë² ì´ìŠ¤ì—ëŠ” ê°ì²´ì§€í–¥ ì–¸ì–´ì˜ ìƒì†ì„ í‘œí˜„í•˜ëŠ” ê°œë…ì´ ì—†ë‹¤. ORMì—ì„œëŠ” ì´ëŸ¬í•œ ìƒì†ì„ í‘œí˜„í•˜ê¸° ìœ„í•´ ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ê´€ê³„ë¥¼ ì‚¬ìš©í•˜ëŠ”ë°. ë°©ë²•ì€ ì„¸ê°€ì§€ì´ë‹¤.

- ê°ê°ì˜ í…Œì´ë¸” ë³€í™˜
- í†µí•© í…Œì´ë¸”ë¡œ ë³€í™˜
- ì„œë¸Œíƒ€ì… í…Œì´ë¸”ë¡œ ë³€í™˜

## 1. ì¡°ì¸ ì „ëµ

ì¡°ì¸ ì „ëµì€ ì—”í‹°í‹° ê°ê° ëª¨ë‘ í…Œì´ë¸”ë¡œ ë§Œë“¤ê³  ìì‹ í…Œì´ë¸”ì€ ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ë°›ì•„ì„œ **ê¸°ë³¸í‚¤ + ì™¸ë˜í‚¤**ë¡œ ì‚¬ìš©í•œë‹¤.

```java
@Entity
@Inheritance(strategy = InheritanceType.JOINED)
@DiscriminatorColumn(name = "DTYPE")
public abstrct class Item {                 

	@Id @GeneratedValue
	@Column(name = "ITEM_ID")
	private Long id;
	
	....
}

@Entity
@DiscriminatorValue("A")
public class Album extends Item {
	..
}
```

- **Inheritance** :  ìƒì† ë§¤í•‘ì„ ìœ„í•´ ë°˜ë“œì‹œ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ìœ„ì˜ ì˜ˆì‹œëŠ” ì¡°ì¸ íƒ€ì…ìœ¼ë¡œ ëª…ì‹œí–ˆë‹¤.
- **DiscriminatorColumn** :  êµ¬ë¶„ ì»¬ëŸ¼ìœ¼ë¡œ ë¶€ëª¨ í´ë˜ìŠ¤ì—ì„œ ìì‹ í´ë˜ìŠ¤ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ íƒ€ì… ì¹¼ëŸ¼ìœ¼ë¡œ ë³´ë©´ ëœë‹¤. ê¸°ë³¸ ê°’ì€ â€œDTYPEâ€ ì´ë‹¤.
- **DiscriminatorValue** : ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ êµ¬ë¶„ ì¹¼ëŸ¼ì— ì…ë ¥í•  ê°’ì„ ì§€ì •í•œë‹¤.

### ë‹¨ì 

- ì¡°íšŒí•  ë•Œ ì¡°ì¸ì´ ì‚¬ìš©ë˜ë¯€ë¡œ ì„±ëŠ¥ ì €í•˜ê°€ ë  ìˆ˜ ìˆë‹¤.
- ì¡°íšŒ ì¿¼ë¦¬ê°€ ë³µì¡í•˜ë‹¤.
- INSERT SQLì´ ë‘ ë²ˆ ì‚¬ìš©ëœë‹¤.

## 2. ë‹¨ì¼ í…Œì´ë¸” ì „ëµ

ë‹¨ì¼ í…Œì´ë¸” ì „ëµì€ ë¶€ëª¨ í…Œì´ë¸”ì— ìì‹ì˜ í•„ë“œë“¤ì„ ëª¨ì¡°ë¦¬ ë„£ì–´ë²„ë¦°ë‹¤. ê·¸ë¦¬ê³  ìì‹ ì¹¼ëŸ¼ì˜ êµ¬ë¶„ì€ êµ¬ë¶„ ì¹¼ëŸ¼ìœ¼ë¡œ í•œë‹¤. í•œ ê³³ì— ìˆê¸° ë•Œë¬¸ì— ì¡°ì¸ì´ ì—†ë‹¤. ìƒëŒ€ì ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ì´ ë¹ ë¥´ë‹¤.

```java
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "DTYPE")
public abstrct class Item {   
```

### ë‹¨ì 

- ìì‹ ì—”í‹°í‹°ê°€ ë§¤í•‘í•œ ì¹¼ëŸ¼ì€ ëª¨ë‘ nullì„ í—ˆìš©í•´ì•¼ í•œë‹¤. ì´ìœ ëŠ” ë‹¤ë¥¸ ìì‹ ì—”í‹°í‹°ì˜ í•„ë“œë“¤ì´ ë¶€ëª¨ì— í•¨ê»˜ ìˆê¸° ë•Œë¬¸ì— í•„ìš”ì—†ëŠ” ì¹¼ëŸ¼ë„ ê²°êµ­ í¬í•¨í•œë‹¤.
- ë‹¨ì¼ í…Œì´ë¸”ì— ëª¨ë“  ê²ƒì„ ì €ì¥í•˜ë¯€ë¡œ í…Œì´ë¸”ì´ ì»¤ì§ˆ ìˆ˜ ìˆë‹¤.

# MappedSuperclass

ì—”í‹°í‹°ëŠ” ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì •ë³´ë“¤ì´ ìˆì„ ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë“±ë¡ì¼, ì‚­ì œì¼, ìˆ˜ì •ì¼, ìˆ˜ì •ìì™€ ê°™ì€ ì •ë„ë“¤ì´ ë  ìˆ˜ ìˆëŠ”ë°. ì´ëŸ¬í•œ ì •ë³´ë“¤ì„ ë§¤í•‘í•˜ê¸° ìœ„í•´ **MappedSuperclass**ë¥¼ ì‚¬ìš©í•œë‹¤. ê°€ëŠ¥í•˜ë©´ ì¶”ìƒ í´ë˜ìŠ¤ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.

```java
@MappedSuperclass
public abstract class BaseEntity {
	@Id @GeneratedValue
	private Long id;
	private String name;
}

@Entity
public class Member extends BaseEntity {
	..
}
```

ìƒì†ë°›ì€ ì—”í‹°í‹°ëŠ” **BaseEntity**ì˜ í•„ë“œë“¤ì´ ìë™ìœ¼ë¡œ ë“±ë¡ëœë‹¤. ìƒì†ì„ ë°›ì•˜ì§€ë§Œ BaseEntityì™€ëŠ” ë‹¤ë¥¸ ì¹¼ëŸ¼ëª…ì„ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ìˆ˜ ìˆë‹¤. 

```java
@Entity
@AttributeOverride(name = "id", column = @Column(name = "MEMBER_ID"))
public class Member extends BaseEntity {

}

// ì—¬ëŸ¬ ê°œ
@Entity
@AttributeOverrides({
	@AttributeOverride(name = "id", column = @Column(name = "MEMBER_ID")),
	@AttributeOverride(name = "name", column = @Column(name = "MEMBER_NAME"))
})
public class Member extends BaseEntity {

}
```

# ë³µí•© í‚¤ì™€ ì‹ë³„ ê´€ê³„ ë§¤í•‘

ë¨¼ì € ìš©ì–´ë¥¼ ì„¤ëª…í•˜ë©´ ì‹ë³„ ê´€ê³„ëŠ” ë¶€ëª¨ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ìì‹ í…Œì´ë¸”ì—ì„œ ê¸°ë³¸ í‚¤ë¡œ ì‚¬ìš©í•˜ë©´ **ì‹ë³„ ê´€ê³„**ì´ê³  ë‹¨ìˆœ ì™¸ë˜ í‚¤ë¡œ ì‚¬ìš©í•˜ë©´ **ë¹„ì‹ë³„ ê´€ê³„**ë¼ê³  í•œë‹¤.

ë˜ ì´ **ë¹„ì‹ë³„ ê´€ê³„**ì—ì„œ ì™¸ë˜ í‚¤ê°€ NULLì„ í—ˆìš©í•˜ì§€ ì•Šìœ¼ë©´ **í•„ìˆ˜ì  ë¹„ì‹ë³„ ê´€ê³„**ë¼ê³  í•˜ë©°, í—ˆìš©í•˜ë©´ **ì„ íƒì  ë¹„ì‹ë³„ ê´€ê³„**ë¼ í•œë‹¤.

JPAì—ì„œ ë³µí•©í‚¤ë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆëŠ”ë°. **@IdClass**ì™€ **@EmbeddedId**ê°€ ì´ë‹¤. **IdClass**ëŠ” ì¢€ ë” ë°ì´í„°ë² ì´ìŠ¤ë‹¤ìš´ ë°©ë²•ìœ¼ë¡œ ê°ì²´ ìì²´ì— ë‘ ê°€ì§€ IDê°€ ê°™ì´ ë“¤ì–´ì‡ë‹¤.

## IdClass

```java
@Entity
@IdClass(ParentId.class)
public class Parent {
	@Id
	@Column(name = "PARENT_ID1")
	private String id1;

	@Id
	@Column(name = "PARENT_ID2")
	private String id2;
}

public class ParentId implements Serializable {
	private String id1;
	private String id2;

	public ParentId(){
	}
	
	public ParentId(String id1, String id2) {
		this.id1 = id1;
		this.id2 = id2;
	}

	@Override
	public boolean equals(Object o) {...}

	@Override
	public int hashCode() {...}
}

// ìì‹ í´ë˜ìŠ¤(ì™¸ë˜ í‚¤ ì‚¬ìš©)
@Entity
public class Child {
	
	@Id
	private String id;
	
	@ManyToOne
	@JoinColumns({
		@JoinColumn(name = "PARENT_ID1", referencedColumnName = "PARENT_ID1"), 
		@JoinColumn(name = "PARENT_ID2", referencedColumnName = "PARENT_ID2"), 
	})
	private Parent parent;
}
```

ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„  ë‹¤ìŒì„ ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•œë‹¤.

- **ì‹ë³„ì í´ë˜ìŠ¤ì˜ ì†ì„±ëª…ê³¼ ì—”í‹°í‹°ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì‹ë³„ìì˜ ì†ì„±ëª…ì€ ê°™ì•„ì•¼ í•œë‹¤.**
- **Serializable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤**
- **equals, hashCodeë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.**
- **ê¸°ë³¸ ìƒì„±ìê°€ ìˆì–´ì•¼ í•œë‹¤.**
- **ì‹ë³„ì í´ë˜ìŠ¤ëŠ” public ì´ì–´ì•¼ í•œë‹¤.**

ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìì²´ì—ì„œ ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ, ì´ ParentId í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ë§Œë“¤ì–´ì„œ í‚¤ë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— ì´ëŸ¬í•œ ì¡°ê±´ë“¤ì´ í•„ìš”í•˜ë‹¤. 

ë§Œì•½ ë‹¤ë¥¸ ì—”í‹°í‹°ì—ì„œ ì™¸ë˜í‚¤ë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ ì˜ˆì‹œì˜ Childì²˜ëŸ¼ **ë³µí•©í‚¤ë¥¼ ëª¨ë‘ ë“±ë¡**í•´ì•¼ í•œë‹¤.

## EmbeddedId

IdClassì™€ ë‹¤ë¥´ê²Œ ì¡°ê¸ˆ ë” ê°ì²´ì§€í–¥ì ì¸ ë°©ë²•ì´ë‹¤. ì˜ˆì œë¥¼ ì‚´í´ë³´ì.

```java
@Entity
public class Parent {

	@EmbeddedId
	private ParentId id;
}

@Embeddable
public class ParentId implements Serializable {
	@Column(name = "PARENT_ID1")
	private String id1;

	@Column(name = "PARENT_ID2")
	private String id2;

	// equals And hashCode êµ¬í˜„
}
```

EmbeddedIdë„ ë‹¤ìŒê³¼ ê°™ì€ ì¡°ê±´ì„ ì§€ì¼œì¤˜ì•¼ í•˜ë‚Ÿ.

- **@EmbeddedId ì• ë„ˆí…Œì´ì…˜ì„ ë¶™ì—¬ì¤˜ì•¼ í•œë‹¤.**
- **Serializable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.**
- **equals, hashCode ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.**
- **ê¸°ë³¸ ìƒì„±ìê°€ ìˆì–´ì•¼ í•œë‹¤.**
- **ì‹ë³„ì í´ë˜ìŠ¤ëŠ” public ì´ì–´ì•¼ í•œë‹¤.**

## IdClass vs EmbeddedID ì‚¬ìš© ì˜ˆì‹œ

```java
em.createQuery("select p.id.id1, p.id.id2 from Paren p"); // @EmbeddedId
em.createQuery("select p.id1, p.id2 from Parent p");  // IdClass
```

<aside>
ğŸ’¡ **ì£¼ì˜í•  ì ì€ ë³µí•©í‚¤ëŠ” @GenerateValueë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.**

</aside>

# ë³µí•© í‚¤: ì‹ë³„ ê´€ê³„ ë§¤í•‘

ë¶€ëª¨ â†’ ìì‹ â†’ ì†ìì˜ ê´€ê³„ê°€ ê°ê° ì‹ë³„ ê´€ê³„ë¼ê³  í•´ë³´ì.

## @IdClassì™€ ì‹ë³„ ê´€ê³„

```java
// ë¶€ëª¨
@Entity 
public class Parent {
	
	@Id @Column(name = "PARENT_ID")
	private String id;
	...
}

// ìì‹
@Entity
@IdClass(ChildId.class)
public class Child {
	@Id
	@ManyToOne
	@JoinColumn(name = "PARENT_ID")
	public Parent parent;
	
	@Id @Column(name = "CHILD_ID")
	private String childId;
}

public class ChildId implements Serializable {
	private String parent;  // child í´ë˜ìŠ¤ì˜ parent í•„ë“œì™€ ë§¾ì´
	private String childId;
}

// ì†ì
@Entity
@IdClass(GrandChildId.class)
public class GrandChild {

	@Id
	@ManyToOne
	@JoinColumns({
		@JoinColumn(name = "PARENT_ID"),
		@JoinCOlumn(name = "CHIlD_ID")
	})
	private Child child;

	@Id @Column(name = "GRANDCHIlD_ID")
	private String id;
}

public class GrandChildId implements Serializable {
	private ChildId child;
	private String id;
}
```

## @EmbeddedId ì‹ë³„ ê´€ê³„

EmbeddedIdëŠ” **@MapsId**ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```java
// ë¶€ëª¨
@Entity 
public class Parent {
	
	@Id @Column(name = "PARENT_ID")
	private String id;
	...
}

// ìì‹
@Entity
public class Child {

	@EmbeddedId
	private ChildId id;

	@MapsId("parentId") // ChildId.parentId ë§¤í•‘
	@ManyToOne
	@JoinColumn(name = "PARENT_ID")
	public Parent parent;
	
	@Id @Column(name = "CHILD_ID")
	private String childId;
}

public class ChildId implements Serializable {
	private String parentId;  

	@Column(name = "CHIlD_ID")
	private String id;
}

// ì†ì
@Entity
public class GrandChild {

	@EmbeddedId
	private GrandChildId id;

	@MapsId("childId")
	@ManyToOne
	@JoinColumns({
		@JoinColumn(name = "PARENT_ID"),
		@JoinCOlumn(name = "CHIlD_ID")
	})
	private Child child;

	@Id @Column(name = "GRANDCHIlD_ID")
	private String id;
}

public class GrandChildId implements Serializable {
	private ChildId childId;

	@Column(name = "GRANDCHIlD_ID")
	private String id;
}
```

# ì¡°ì¸ í…Œì´ë¸”

ì¡°ì¸ ì¹¼ëŸ¼ì€ ë„˜ì–´ê°€ê³  ì¡°ì¸ í…Œì´ë¸”ë§Œ ë³´ê² ë‹¤.

## ì¼ëŒ€ì¼ ì¡°ì¸ í…Œì´ë¸”

```java
@Entity
public class Parent {
	@Id @GeneratedValue
	@Column(name = "PARENT_ID")
	private Long id;
	
	@OneToOne
	@JoinTable(name = "PARENT_CHIlD",
				joinColumns = @JoinColumn(name = "PARENT_ID"),
				inverseJoinColumns = @JoinColumn(name = "CHILD_ID")
	)
	private Child child;
}

@Entity
public class Child {
	
	@Id @GeneratedValue
	@Column(name = "CHIlD_ID")
	private Long id;
}
```

- **name** : ë§¤í•‘í•  ì¡°ì¸ í…Œì´ë¸” ì´ë¦„
- **joinColumns**: í˜„ì¬ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•˜ëŠ” ì™¸ë˜ í‚¤
- **inverseJoinColumns**: ë°˜ëŒ€ë°©í–¥ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•˜ëŠ” ì™¸ë˜ í‚¤

## ì¼ëŒ€ë‹¤ ì¡°ì¸ í…Œì´ë¸”

```java
@Entity
public class Parent {
	@Id @GeneratedValue
	@Column(name = "PARENT_ID")
	private Long id;
	
	@OneToMany
	@JoinTable(name = "PARENT_CHIlD",
				joinColumns = @JoinColumn(name = "PARENT_ID"),
				inverseJoinColumns = @JoinColumn(name = "CHILD_ID")
	)
	private List<Child> child = new ArrayList<>();
}

@Entity
public class Child {
	
	@Id @GeneratedValue
	@Column(name = "CHIlD_ID")
	private Long id;
}
```

## ë‹¤ëŒ€ì¼ ì¡°ì¸ í…Œì´ë¸”

```java
@Entity
public class Parent {
	@Id @GeneratedValue
	@Column(name = "PARENT_ID")
	private Long id;
	
	@OneToMany(mappedBy = "parent")
	private List<Child> child = new ArrayList<>();
}

@Entity
public class Child {
	
	@Id @GeneratedValue
	@Column(name = "CHIlD_ID")
	private Long id;

	@ManyToOne(optional = false)
	@JoinTable(name = "PARENT_CHIlD",
				joinColumns = @JoinColumn(name = "CHILD_ID"),
				inverseJoinColumns = @JoinColumn(name = "PARENT_ID")
	)
	private Parent parent;
}
```

## ë‹¤ëŒ€ë‹¤ ì¡°ì¸ í…Œì´ë¸”

```java
@Entity
public class Parent {
	@Id @GeneratedValue
	@Column(name = "PARENT_ID")
	private Long id;
	
	@ManyToMany
	@JoinTable(name = "PARENT_CHIlD",
				joinColumns = @JoinColumn(name = "PARENT_ID"),
				inverseJoinColumns = @JoinColumn(name = "CHILD_ID")
	)
	private List<Child> child = new ArrayList<>();
}

@Entity
public class Child {
	
	@Id @GeneratedValue
	@Column(name = "CHIlD_ID")
	private Long id;
}
```